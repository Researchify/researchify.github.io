name: GitHub Actions Demo

on: [push, workflow_dispatch]

jobs:
  generate-docs:  
    runs-on: ubuntu-latest
    steps:
    - name: Checkout source code
      uses: actions/checkout@v2
      with:
        repository: 'Researchify/Researchify'
        ref: 'vgoh1/api-documentation'
    - name: Checkout doc repo
      uses: actions/checkout@v2
      with:
        path: 'Researchify'
    - name: print-env
      uses: managedkaos/print-env@master
    - name: ls
      run: 'ls /home/runner/work/researchify.github.io/'
    - name: Generate docs
      uses: andstor/jsdoc-action@v1
      with:
        source_dir: ./Researchify/api/src
        output_dir: ./Researchify/researchify.github.io/docs
        template: docdash
        config_file: ./api/jsdoc_config.json
        front_page: README.md
    - name: Commit and push docs to branch
      uses: actions-js/push@master
      with:
        github_token: $${{ secrets.GITHUB_TOKEN }}
        branch: main
        message: "Generate API documentation"
        directory: './Researchify/researchify.github.io/docs'

  deploy-docs:
    runs-on: ubuntu-latest
    needs:
      - generate-docs
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Deploy to GitHub Pages
      uses: JamesIves/github-pages-deploy-action@4.1.1
      with:
        branch: main
        folder: ./docs
